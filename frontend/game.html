<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity AI RPG - Jogo</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Background Animation (Global) -->
    <div class="stars-wrapper">
        <div class="stars"></div>
        <div class="stars2"></div>
        <div class="stars3"></div>
    </div>

    <!-- App Sidebar (Context Menu) -->
    <aside id="app-sidebar" class="sidebar hidden">
        <div class="sidebar-header">
            <h2>üìú Menu</h2>
            <button id="close-sidebar" class="icon-btn">√ó</button>
        </div>
        <div class="sidebar-content">
            <button id="back-dashboard-btn" class="btn-primary full-width" style="margin-bottom: 15px;">‚¨Ö Voltar ao
                Menu</button>

            <!-- New Campaign Section -->
            <button id="sidebar-new-campaign-btn" class="btn-primary full-width"
                style="margin-bottom: 20px; background: linear-gradient(135deg, #ffd700, #ffa500); color: black; font-weight: bold;">+
                Nova
                Campanha</button>

            <h3
                style="font-size: 0.9rem; color: #aaa; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">
                Minhas Campanhas</h3>
            <div id="sidebar-campaign-list" class="campaign-list" style="max-height: 300px; overflow-y: auto;">
                <!-- Campaigns loaded via JS -->
            </div>
        </div>
        <div class="sidebar-footer">
            <div id="user-profile-trigger" class="user-info-mini"
                style="cursor: pointer; padding: 10px; border-radius: 8px; transition: background 0.2s;">
                <span id="sidebar-username" style="font-weight: bold;">Usu√°rio</span>
                <small style="display: block; color: #aaa; font-size: 0.7rem;">Clique para perfil</small>
            </div>
            <button id="logout-btn" class="btn-cancel" style="margin-top: 10px; width: 100%;">Sair</button>
        </div>
    </aside>

    <main id="main-content">
        <div class="game-layout">
            <!-- Left Column: Chat -->
            <div class="chat-section">
                <header>
                    <div class="header-left">
                        <button id="menu-btn" class="icon-btn">‚ò∞</button>
                        <h1>‚ú¶ Infinity AI RPG</h1>
                    </div>
                    <div class="header-buttons">
                        <button id="reset-btn" class="icon-btn danger" title="Resetar Jogo">‚Ü∫</button>
                    </div>
                </header>

                <div id="messages" class="messages-area">
                    <!-- Messages will be loaded here -->
                </div>

                <div class="input-area">
                    <input type="text" id="user-input" placeholder="Digite sua a√ß√£o..." autocomplete="off">
                    <button id="send-btn">‚û§</button>
                </div>
            </div>

            <!-- Right Column: Inventory Sidebar -->
            <aside id="inventory-sidebar" class="inventory-sidebar">
                <!-- Stats Header -->
                <div class="sidebar-stats">
                    <div id="stats-display" class="stats-grid">
                        <!-- Populated by JavaScript -->
                    </div>
                    <div id="attributes-display" class="attributes-section">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Tab Navigation -->
                <div class="sidebar-tabs">
                    <button class="sidebar-tab active" data-tab="grimorio">üìú Grim√≥rio</button>
                    <button class="sidebar-tab" data-tab="equipment">‚öîÔ∏è Equipamentos</button>
                    <button class="sidebar-tab" data-tab="inventory">üéí Invent√°rio</button>
                </div>

                <!-- Tab Content -->
                <div class="sidebar-content">
                    <div id="tab-grimorio" class="tab-pane active">
                        <!-- Spells will be loaded here -->
                    </div>
                    <div id="tab-equipment" class="tab-pane hidden">
                        <!-- Equipment will be loaded here -->
                    </div>
                    <div id="tab-inventory" class="tab-pane hidden">
                        <!-- Items will be loaded here -->
                    </div>
                </div>

                <!-- Future Space -->
                <!-- Dice Roller Trigger (Icon) -->
                <div id="dice-trigger" class="sidebar-footer-trigger" title="Abrir Dados">
                    <div class="dice-icon-container">
                        <div class="dice-icon-3d">
                            <div class="face front"></div>
                            <div class="face back"></div>
                            <div class="face right"></div>
                            <div class="face left"></div>
                            <div class="face top"></div>
                            <div class="face bottom"></div>
                        </div>
                    </div>
                    <span class="dice-trigger-label">ROLAGEM DE DADOS</span>
                </div>

                <!-- Dice Roller Section (Expanded) -->
                <div id="dice-container" class="sidebar-footer collapsed">
                    <!-- Sub-container for the 3D scene -->
                    <div id="dice-scene-root" style="width: 100%; height: 100%;"></div>
                    <!-- Close button is now injected by dice_3d.js to ensure visibility -->
                </div>
            </aside>
        </div>
    </main>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay hidden"></div>

    <!-- Creation Modal Removed (Using shared_modal.js) -->

    <!-- Status Modal -->
    <div id="status-modal" class="modal hidden">
        <div class="modal-header">
            <h2>üéí Invent√°rio & Status</h2>
            <button class="close-modal">√ó</button>
        </div>
        <div class="modal-body" id="status-content">
            Carregando...
        </div>
    </div>

    <!-- Reset Modal -->
    <div id="reset-modal" class="modal hidden">
        <div class="modal-header">
            <h2>‚ö†Ô∏è Resetar Jogo?</h2>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <p>Isso apagar√° TODO o seu progresso atual nesta campanha, invent√°rio e hist√≥rico. Tem certeza?</p>
            <div class="modal-actions">
                <button id="cancel-reset" class="btn-cancel">Cancelar</button>
                <button id="confirm-reset" class="btn-danger">Sim, Resetar</button>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="user-modal" class="modal hidden">
        <div class="modal-header">
            <h2>üë§ Minha Conta</h2>
            <button class="close-modal">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Usu√°rio</label>
                <input type="text" id="profile-username" readonly style="opacity: 0.7; cursor: default;">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="text" id="profile-email" readonly style="opacity: 0.7; cursor: default;">
            </div>

            <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;">

            <div class="form-group">
                <label>Alterar Senha</label>
                <button class="btn-primary full-width" style="margin-bottom: 10px;">Redefinir Senha</button>
            </div>
            <div class="form-group">
                <label>Assinatura</label>
                <button class="btn-primary full-width"
                    style="background: linear-gradient(135deg, #ffd700, #ffa500); color: black; font-weight: bold;">‚≠ê
                    Ver Planos</button>
            </div>

            <div class="modal-actions" style="justify-content: flex-end;">
                <button class="btn-cancel close-modal">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Delete Campaign Modal -->
    <div id="delete-modal" class="modal hidden">
        <div class="modal-header">
            <h2>üóëÔ∏è Excluir Campanha?</h2>
            <button class="close-modal">√ó</button>
        </div>
        <div class="modal-body">
            <p>Tem certeza que deseja apagar esta campanha para sempre? Esta a√ß√£o <strong>n√£o pode ser
                    desfeita</strong>.</p>
            <div class="modal-actions">
                <button id="cancel-delete" class="btn-cancel">Cancelar</button>
                <button id="confirm-delete" class="btn-danger">Excluir Permanentemente</button>
            </div>
        </div>
    </div>

    <!-- 3D Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>

    <!-- Shared Modules (CRITICAL - load order) -->
    <script src="auth.js"></script>
    <script src="shared_api.js"></script>
    <script src="shared_modals.js"></script>
    <script src="shared_campaigns.js"></script>

    <!-- Detailed Modules -->
    <script src="shared_modal.js"></script> <!-- Character Creation Modal Logic -->
    <script src="character_creation.js"></script>
    <script src="narrative_overlay.js"></script>
    <script src="validation_fix.js"></script>

    <!-- Game Specific -->
    <script src="sidebar_inventory.js"></script>
    <script src="mode_inventory.js"></script>
    <script src="dice_3d.js"></script> <!-- New Dice Logic -->
    <script src="game.js"></script>
</body>

</html>